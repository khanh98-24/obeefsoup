@model OBeefSoup.Models.ViewModels.AboutFeatureViewModel
@{
    ViewData["Title"] = (Model.Id == 0 ? "Thêm" : "Sửa") + " thành phần Giới thiệu";
}

<style>
    .custom-admin-tabs .nav-link {
        color: #495057 !important;
        border-radius: 10px 10px 0 0;
    }
    .custom-admin-tabs .nav-link.active {
        color: var(--accent-color) !important;
        font-weight: 600;
        border-bottom: 2px solid var(--accent-color) !important;
    }
    .feature-icon-custom {
        display: inline-block;
        width: 50px;
        height: 50px;
        background-color: var(--accent-color);
        -webkit-mask-size: contain;
        mask-size: contain;
        -webkit-mask-repeat: no-repeat;
        mask-repeat: no-repeat;
        -webkit-mask-position: center;
        mask-position: center;
    }
</style>

<div class="container py-5">
    <div class="row">
        <div class="col-md-6 offset-md-3">
            <div class="card border-0 shadow-sm rounded-4">
                <div class="card-header bg-white py-3 border-0">
                    <h5 class="mb-0 fw-bold text-dark">
                        <i class="bi @(Model.Id == 0 ? "bi-plus-circle-fill text-success" : "bi-pencil-square text-warning") me-2"></i>
                        @ViewData["Title"]
                    </h5>
                </div>
                <div class="card-body p-4">
                    <form asp-action="EditFeature" method="post" enctype="multipart/form-data">
                        <input type="hidden" asp-for="Id" />
                        <input type="hidden" asp-for="IconImageUrl" />
                        
                        <div class="mb-3">
                            <label asp-for="Title" class="form-label fw-bold"></label>
                            <input asp-for="Title" class="form-control" placeholder="Ví dụ: Ninh 12 Tiếng" />
                            <span asp-validation-for="Title" class="text-danger small"></span>
                        </div>

                        <ul class="nav nav-tabs mb-3 custom-admin-tabs" id="iconTab" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link @(string.IsNullOrEmpty(Model.IconImageUrl) ? "active" : "")" id="class-tab" data-bs-toggle="tab" data-bs-target="#class-pane" type="button" role="tab">Bootstrap Icon</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link @(!string.IsNullOrEmpty(Model.IconImageUrl) ? "active" : "")" id="image-tab" data-bs-toggle="tab" data-bs-target="#image-pane" type="button" role="tab">Ảnh từ máy</button>
                            </li>
                        </ul>
                        <div class="tab-content" id="iconTabContent">
                            <div class="tab-pane fade @(string.IsNullOrEmpty(Model.IconImageUrl) ? "show active" : "")" id="class-pane" role="tabpanel">
                                <div class="mb-3">
                                    <label asp-for="IconClass" class="form-label fw-bold"></label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-light"><i class="bi @(Model.IconClass ?? "bi-star-fill")" id="iconPreview"></i></span>
                                        <input asp-for="IconClass" class="form-control" id="iconInput" placeholder="bi-clock-history" />
                                    </div>
                                    <span asp-validation-for="IconClass" class="text-danger small"></span>
                                    <div class="mt-2 small text-muted">
                                        <i class="bi bi-info-circle me-1"></i>Sử dụng class của <a href="https://icons.getbootstrap.com/" target="_blank">Bootstrap Icons</a>.
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade @(!string.IsNullOrEmpty(Model.IconImageUrl) ? "show active" : "")" id="image-pane" role="tabpanel">
                                <div class="mb-3">
                                    <label asp-for="IconImageFile" class="form-label fw-bold"></label>
                                    @if (!string.IsNullOrEmpty(Model.IconImageUrl))
                                    {
                                        <div class="mb-2">
                                            <p class="small text-muted mb-1">Icon hiện tại:</p>
                                            <div class="img-thumbnail p-2 d-inline-block">
                                                <span class="feature-icon-custom" style="-webkit-mask-image: url('@Model.IconImageUrl'); mask-image: url('@Model.IconImageUrl');"></span>
                                            </div>
                                        </div>
                                    }
                                    <input asp-for="IconImageFile" type="file" class="form-control" accept="image/*,.svg" id="iconImageUpload" />
                                    <span asp-validation-for="IconImageFile" class="text-danger small"></span>
                                    <div id="iconImagePreviewWrap" class="mt-3" style="display:none;">
                                        <p class="small text-muted mb-1">Icon mới:</p>
                                        <div class="img-thumbnail p-2 d-inline-block">
                                            <span id="iconImagePreview" class="feature-icon-custom"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-6">
                                <label asp-for="DisplayOrder" class="form-label fw-bold"></label>
                                <input asp-for="DisplayOrder" class="form-control" type="number" />
                                <span asp-validation-for="DisplayOrder" class="text-danger small"></span>
                            </div>
                            <div class="col-6 d-flex align-items-end">
                                <div class="form-check mb-2">
                                    <input asp-for="IsActive" class="form-check-input" type="checkbox" />
                                    <label asp-for="IsActive" class="form-check-label"></label>
                                </div>
                            </div>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                            <a asp-action="Index" class="btn btn-light rounded-pill px-4">Hủy</a>
                            <button type="submit" class="btn btn-primary rounded-pill px-4">
                                @(Model.Id == 0 ? "Thêm mới" : "Cập nhật")
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        document.getElementById('iconInput').addEventListener('input', function(e) {
            const iconClass = e.target.value.trim() || 'bi-star-fill';
            document.getElementById('iconPreview').className = 'bi ' + iconClass;
        });

        document.getElementById('iconImageUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const preview = document.getElementById('iconImagePreview');
                    preview.style.webkitMaskImage = `url('${event.target.result}')`;
                    preview.style.maskImage = `url('${event.target.result}')`;
                    document.getElementById('iconImagePreviewWrap').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });
    </script>
}
