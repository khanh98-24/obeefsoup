@model List<OBeefSoup.Models.Product>
@{
    ViewData["Title"] = "Thực Đơn";
    var categories = ViewBag.Categories as List<OBeefSoup.Models.Category>;
}


<!-- Hero Section -->
<section class="hero-section menu-hero" style="
    background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), 
                url('/images/486748406_1200441442085265_4112327303630339444_n.jpg') center/cover no-repeat,
                linear-gradient(135deg, var(--color-primary) 0%, #8B0000 100%); 
    position: relative;
    overflow: hidden;">
    <div class="container text-center text-white" style="position: relative; z-index: 2;">
        <h1 class="display-4 fw-bold mb-3" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">Thực Đơn Đầy Đủ</h1>
        <p class="lead" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">Khám phá hương vị phở bò chính gốc cùng O' BeefSoup</p>
    </div>
</section>

<!-- Menu Section -->
<section class="menu-section py-4">
    <div class="container">
        <!-- Category Filter Bar -->
        <div class="category-filter-wrapper sticky-top">
            <div class="d-flex overflow-auto no-scrollbar gap-2 px-2 py-1 justify-content-md-center container-fluid">
                <button class="filter-btn active" data-filter="all">Tất cả</button>
                @foreach (var category in categories)
                {
                    <button class="filter-btn" data-filter="cat-@category.Id">@category.Name</button>
                }
            </div>
        </div>

        <div id="menu-items-container">
            @foreach (var category in categories)
            {
                var categoryProducts = Model.Where(p => p.CategoryId == category.Id).ToList();
                
                if (categoryProducts.Any())
                {
                    <div class="menu-category-group mb-5" id="cat-@category.Id">
                        <div class="category-header text-center mb-4">
                            <h2 class="category-title">@category.Name</h2>
                            @if (!string.IsNullOrEmpty(category.Description))
                            {
                                <p class="text-muted">@category.Description</p>
                            }
                            <div class="category-divider"></div>
                        </div>

                        <div class="row g-3 g-md-4">
                            @foreach (var product in categoryProducts)
                            {
                                <div class="col-6 col-md-6 col-lg-4">
                                    <div class="menu-card h-100" 
                                         style="cursor: pointer;" 
                                         onclick="if(!event.target.closest('.add-to-cart-btn')) window.location.href='@Url.Action("Details", "Menu", new { id = product.Id })'">
                                        <div class="menu-card-image">
                                            <img src="@product.ImageUrl" alt="@product.Name" class="img-fluid" loading="lazy">
                                            @if (product.IsFeatured)
                                            {
                                                <span class="badge-featured">Nổi bật</span>
                                            }
                                        </div>
                                        <div class="menu-card-body">
                                            <h5 class="menu-card-title">@product.Name</h5>
                                            <p class="menu-card-description">@product.Description</p>
                                            <div class="d-flex justify-content-between align-items-center mt-auto">
                                                <span class="menu-card-price">@product.Price.ToString("N0")đ</span>
                                                <button class="btn btn-primary add-to-cart-btn" 
                                                        onclick="event.stopPropagation();"
                                                        data-product-id="@product.Id"
                                                        data-product-name="@product.Name"
                                                        data-product-price="@product.Price"
                                                        data-product-image="@product.ImageUrl">
                                                    <i class="bi bi-cart-plus me-1"></i><span class="d-none d-sm-inline">Thêm</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                }
            }
        </div>

        @if (!Model.Any())
        {
            <div class="text-center py-5">
                <i class="bi bi-inbox display-1 text-muted"></i>
                <p class="text-muted mt-3">Chưa có sản phẩm nào</p>
            </div>
        }
    </div>
</section>

<style>
    .category-filter-wrapper {
        background: rgba(255, 255, 255, 0.9) !important;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
    }
    .no-scrollbar::-webkit-scrollbar {
        display: none;
    }
    .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
    .filter-btn {
        background: #f8f9fa;
        border: 1px solid #eee;
        color: #666;
        padding: 8px 18px;
        border-radius: 50px;
        white-space: nowrap;
        font-weight: 500;
        font-size: 0.9rem;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
    }
    .filter-btn:hover {
        background: #eee;
        transform: translateY(-2px);
    }
    .filter-btn.active {
        background: var(--color-primary);
        color: #fff;
        border-color: var(--color-primary);
        box-shadow: 0 4px 12px rgba(139, 0, 0, 0.2);
    }
    .category-divider {
        width: 60px;
        height: 3px;
        background: var(--color-primary);
        margin: 1rem auto;
        border-radius: 2px;
    }
    .menu-category-group {
        transition: all 0.4s ease;
    }
    .menu-card {
        border-radius: 15px;
        overflow: hidden;
        border: 1px solid #eee;
        background: #fff;
        transition: all 0.3s ease;
    }
    .menu-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.05);
    }
</style>

<!-- CTA Section -->
<section class="cta-section py-5 position-relative" style="background: transparent !important;">
    <div class="container text-center position-relative" style="z-index: 100;">
        <h3 class="mb-3 fw-bold">Sẵn sàng đặt món?</h3>
        <p class="text-muted mb-4">Thêm món yêu thích vào giỏ hàng và đặt ngay hôm nay!</p>
        <button onclick="window.location.href='/Cart'" class="btn btn-primary btn-lg rounded-pill px-5 shadow-sm border-0" style="cursor: pointer; position: relative; z-index: 110;">
            <i class="bi bi-cart3 me-2"></i>Xem giỏ hàng
        </button>
    </div>
</section>


@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const filterBtns = document.querySelectorAll('.filter-btn');
            const categoryGroups = document.querySelectorAll('.menu-category-group');

            filterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const filter = this.getAttribute('data-filter');

                    // Update UI active state
                    filterBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    // Filter logic
                    categoryGroups.forEach(group => {
                        if (filter === 'all' || group.id === filter) {
                            group.style.display = 'block';
                            // Trigger animation
                            group.style.opacity = '0';
                            setTimeout(() => {
                                group.style.opacity = '1';
                                group.style.transform = 'translateY(0)';
                            }, 50);
                        } else {
                            group.style.display = 'none';
                        }
                    });

                    // Wait for display changes to settle then scroll
                    setTimeout(() => {
                        const targetGroup = document.getElementById(filter);
                        if (targetGroup) {
                            targetGroup.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        } else {
                            window.scrollTo({
                                top: document.querySelector('.menu-section').offsetTop - 60,
                                behavior: 'smooth'
                            });
                        }
                    }, 50);
                });
            });

            // Handle URL Hash (e.g. #category-1)
            const hash = window.location.hash;
            if (hash && hash.startsWith('#category-')) {
                const catId = hash.replace('#category-', 'cat-');
                const targetBtn = document.querySelector(`[data-filter="${catId}"]`);
                if (targetBtn) targetBtn.click();
            }
        });
    </script>
}
