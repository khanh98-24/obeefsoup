@model OBeefSoup.Models.Product
@{
    ViewData["Title"] = Model.Name + " - Chi tiết sản phẩm";
    var relatedProducts = ViewBag.RelatedProducts as List<OBeefSoup.Models.Product>;
}


<!-- Product Details Section -->
<section class="product-details-section py-4 animate-on-scroll">
    <div class="container">
        <div class="row g-5">
            <!-- Product Image -->
            <div class="col-lg-6">
                <div class="product-image-wrapper p-0 rounded-4 position-relative" id="img-container">
                    <img id="main-product-image" src="@Model.ImageUrl" alt="@Model.Name" class="img-fluid rounded-4 w-100" style="object-fit: cover; min-height: 400px; cursor: crosshair;">
                    <div id="zoom-lens" class="zoom-lens"></div>
                    <div id="zoom-result" class="zoom-result shadow-lg rounded-4"></div>
                </div>
            </div>

            <!-- Product Info -->
            <div class="col-lg-6">
                <div class="product-info-content ps-lg-4">
                    <span class="badge bg-primary mb-3 px-3 py-2 rounded-pill">@Model.Category?.Name</span>
                    <h1 class="display-5 fw-bold text-dark mb-3">@Model.Name</h1>
                    <div class="product-price-large mb-4">
                        <span class="text-primary h1 fw-800">@Model.Price.ToString("N0")đ</span>
                    </div>
                    
                    <div class="product-description-full mb-5">
                        <h5 class="fw-bold text-dark mb-3">Mô tả sản phẩm</h5>
                        <p class="text-muted fs-5" style="line-height: 1.8;">
                            @Model.Description
                            <br/><br/>
                            Tại O' BeefSoup, mỗi tô phở không chỉ là một món ăn, mà là tinh hoa của nghệ thuật ninh xương suốt 12 giờ kết hợp cùng thịt bò tươi được chọn lọc khắt khe mỗi ngày. Chúng tôi cam kết mang đến hương vị đậm đà, sạch và nguyên bản nhất.
                        </p>
                    </div>

                    <div class="purchase-actions border-top pt-5">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <button class="btn btn-primary btn-lg w-100 py-3 rounded-pill fw-bold add-to-cart-btn action-btn-equal"
                                        data-product-id="@Model.Id"
                                        data-product-name="@Model.Name"
                                        data-product-price="@Model.Price"
                                        data-product-image="@Model.ImageUrl">
                                    <i class="bi bi-cart-plus me-2"></i>THÊM VÀO GIỎ
                                </button>
                            </div>
                            <div class="col-md-6">
                                <button onclick="window.location.href='/Cart'" class="btn btn-outline-dark btn-lg w-100 py-3 rounded-pill fw-bold action-btn-equal">
                                    <i class="bi bi-bag-check me-2"></i>XEM GIỎ HÀNG
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Related Products -->
@if (relatedProducts != null && relatedProducts.Any())
{
    <section class="related-products-section py-4">
        <div class="container">
            <div class="section-header mb-5">
                <h3 class="fw-bold">Món ngon liên quan</h3>
                <hr style="width: 50px; height: 3px; background: var(--color-primary); opacity: 1;">
            </div>
            <div class="row g-4">
                @foreach (var p in relatedProducts)
                {
                    <div class="col-6 col-md-3">
                        <div class="card h-100 border-0 shadow-sm rounded-4 overflow-hidden menu-card" 
                             style="cursor: pointer;"
                             onclick="window.location.href='@Url.Action("Details", "Menu", new { id = p.Id })'">
                            <img src="@p.ImageUrl" class="card-img-top" alt="@p.Name" style="height: 180px; object-fit: cover;">
                            <div class="card-body p-3">
                                <h6 class="text-dark fw-bold mb-1">@p.Name</h6>
                                <p class="text-primary fw-bold mb-0Small">@p.Price.ToString("N0")đ</p>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </section>
}

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const container = document.getElementById('img-container');
            const img = document.getElementById('main-product-image');
            const lens = document.getElementById('zoom-lens');
            const result = document.getElementById('zoom-result');

            if (!container || !img || !lens || !result) return;

            // Set result background
            result.style.backgroundImage = `url('${img.src}')`;

            function moveLens(e) {
                e.preventDefault();
                
                const rect = img.getBoundingClientRect();
                const x = (e.pageX || e.touches[0].pageX) - rect.left - window.pageXOffset;
                const y = (e.pageY || e.touches[0].pageY) - rect.top - window.pageYOffset;

                let lensX = x - (lens.offsetWidth / 2);
                let lensY = y - (lens.offsetHeight / 2);

                // Boundary check
                if (lensX > img.width - lens.offsetWidth) lensX = img.width - lens.offsetWidth;
                if (lensX < 0) lensX = 0;
                if (lensY > img.height - lens.offsetHeight) lensY = img.height - lens.offsetHeight;
                if (lensY < 0) lensY = 0;

                lens.style.left = lensX + "px";
                lens.style.top = lensY + "px";

                // Magnification calculation
                // Note: result size is 350x350, lens is 100x100 -> ratio is 3.5
                const cx = result.offsetWidth / lens.offsetWidth;
                const cy = result.offsetHeight / lens.offsetHeight;

                result.style.backgroundSize = (img.width * cx) + "px " + (img.height * cy) + "px";
                result.style.backgroundPosition = "-" + (lensX * cx) + "px -" + (lensY * cy) + "px";
            }

            container.addEventListener("mousemove", moveLens);
            container.addEventListener("touchmove", moveLens);

            container.addEventListener("mouseenter", function() {
                lens.style.display = "block";
                result.style.display = "block";
                result.style.opacity = "1";
            });

            container.addEventListener("mouseleave", function() {
                lens.style.display = "none";
                result.style.display = "none";
                result.style.opacity = "0";
            });
        });
    </script>
}

<style>
    .details-hero {
        background-color: var(--color-light) !important;
    }
    .product-image-wrapper img {
        transition: var(--transition-smooth);
    }
    .product-price-large {
        background: rgba(139, 26, 26, 0.05);
        display: inline-block;
        padding: 1rem 2rem;
        border-radius: 15px;
        border-left: 5px solid var(--color-primary);
    }
    .action-btn-equal {
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-size: 0.95rem !important;
        transition: all 0.3s ease;
    }
    .action-btn-equal:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    /* Zoom Styles */
    .zoom-lens {
        position: absolute;
        border: 1px solid #d4d4d4;
        width: 120px;
        height: 120px;
        background-color: rgba(255, 255, 255, 0.4);
        cursor: crosshair;
        display: none;
        z-index: 10;
        pointer-events: none;
        border-radius: 10px;
    }
    .zoom-result {
        position: absolute;
        border: 1px solid #d4d4d4;
        width: 400px;
        height: 400px;
        top: 0;
        left: 105%;
        background-repeat: no-repeat;
        display: none;
        z-index: 9999;
        background-color: white;
        transition: opacity 0.3s ease;
        opacity: 0;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    @@media (max-width: 991px) {
        .zoom-result {
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            margin-left: 0;
            width: 300px;
            height: 300px;
        }
    }
</style>
